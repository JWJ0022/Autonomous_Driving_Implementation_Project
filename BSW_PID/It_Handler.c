/*********************************************************************************************************************/
/*-----------------------------------------------------Includes------------------------------------------------------*/
/*********************************************************************************************************************/
#include <BSW_PID/It_Handler.h>

/*********************************************************************************************************************/
/*------------------------------------------------------Macros-------------------------------------------------------*/
/*********************************************************************************************************************/
#define STM                     &MODULE_STM0

/*********************************************************************************************************************/
/*-------------------------------------------------Global variables--------------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*--------------------------------------------Private Variables/Constants--------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*------------------------------------------------Function Prototypes------------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*---------------------------------------------Function Implementations----------------------------------------------*/
/*********************************************************************************************************************/
void Enc_10ms_Handler(void)
{
    UpdateRPMBasedOnSpeed();

    RPM_cal();

    static sint32 ii =0;
    ii++;
    PI_Speed_con();
    PI_Speed_con_B();

    if (speed_pid.Out>=0){
        setMotorControl(0,1);  //void setMotorControl(uint8 direction, uint8 enable)

        PWM_set(speed_pid.Out);      /* Change the intensity of the LED  */

    }
    else {
        setMotorControl(1,1);  //void setMotorControl(uint8 direction, uint8 enable)

        PWM_set(speed_pid.Out*-1);      /* Change the intensity of the LED  */
    }

    if(Motor_B_speed_pid.Out >= 0)
    {
        setMotor_B_Control(0, 1);
        PWM_Motor_B_set(Motor_B_speed_pid.Out);
    }
    else
    {
        setMotor_B_Control(1, 1);
        PWM_Motor_B_set(Motor_B_speed_pid.Out*(-1));
    }

    STM_IT_FLAG = FALSE;
    IfxStm_increaseCompare(STM, g_STMConf.comparator, (uint32)g_ticksFor5ms);
}
